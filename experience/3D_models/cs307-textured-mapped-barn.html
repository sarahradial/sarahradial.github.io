<html>
  <head>
    <title>Textured Mapped Barn</title>
    <script src="textured_barn.js"></script>
    <script src="../libs/three.min.js"></script>
    <script src="../libs/tw.js"></script>
    <script src="../libs/OrbitControls.js"></script>
    <script src="../libs/dat.gui.min.js"></script>
    <style>
      canvas {
        width: 100%;
        height: 70%;
      }
      body {
        margin: 20px;
      }
    </style>
  </head>
<body>
    <div class="content">
      <div class="main">
        <h2>Texture-mapped Barn</h2>
      </div>
      <!--- created script to contain all clown functions--->
      <script>
          // initialize scene
          var renderer = new THREE.WebGLRenderer();
          var scene = new THREE.Scene();
          TW.mainInit(renderer,scene);

          // add lights
          light0 = new THREE.AmbientLight(0xEEEEEE, 0.7);
          light2 = new THREE.DirectionalLight(0xDDDDDD, 0.3);
          light2.position.set(0, 1, 1);
          scene.add(light0);
          scene.add(light2);

          var guiParams = {
            showLighting: true,
            showMaterial: false,
            mode: showLighting,
          };
          var barnLightingMaterial = new THREE.MeshFaceMaterial([new THREE.MeshPhongMaterial({color: 0xFFFFFF})]);
          var barnGeom = TW.createBarn(20, 15, 50);
          addTextureCoords(barnGeom);

          var materialTexture;
          // load image
          TW.loadTextures(["https://drive.google.com/file/d/1CA8aHNXLu7Dw-GPP2c5T76BZjP6OXsC0/view?usp=sharing"],
            function(texture){ materialTexture = texture;});
          // base lighting to show for debugging purposes
          function showLighting(){
            scene.remove(barnMesh);
            createBarnTextureLighting(barnGeom, barnLightingMaterial);
            var barnMesh = new THREE.Mesh(barnGeom, barnLightingMaterial);
            scene.add(barnMesh);
          }
          // have repeated material across walls and roof
          function showMaterial(texture){
            scene.remove(barnMesh);
            console.log(materialTexture);
            var barnMesh = new THREE.Mesh(barnGeom, new THREE.MeshBasicMaterial({color: 0xFFFFFF, map: materialTexture}));
            var imageTexture = barnMesh.material.map;
            console.log(barnMesh);
            if (!imageTexture)
              throw "couldn't find texture map in mess"
            var abbrev = {
              clamp: THREE.ClamptoEdgeWrapping,
              repeat: THREE.RepeatWrapping,
              mirror: THREE.MirroredRepeatWrapping
            };
            imageTexture.wrapS = abbrev["repeat"];
            imageTexture.wrapT = abbrev["repeat"];




            scene.add(barnMesh);
          }

          showMaterial();
          function redo(){
            if (showLighting)
              showLighting();
            if (showMaterial)

              showMaterial();
          }
          var state = TW.cameraSetup(renderer, scene,
               {minx: 0, maxx: 20,
                miny: 0, maxy: 15,
                minz: -50, maxz: 0});

          var gui = new dat.GUI();
          gui.add(guiParams, 'mode', ["showLighting", "showMaterial"]).onChange(redo);

          </script>
    </div>
    </body>
</html>
